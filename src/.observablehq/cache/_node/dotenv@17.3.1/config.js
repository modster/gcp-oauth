import*as G from"fs";import*as x from"path";import*as A from"os";import*as Y from"crypto";function D(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function _(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var U={},l={exports:{}},K=_(G),R=_(x),L=_(A),j=_(Y),k="17.3.1",B={version:k};const g=K,N=R,P=L,M=j,S=B,T=S.version,m=["\u{1F510} encrypt with Dotenvx: https://dotenvx.com","\u{1F510} prevent committing .env to code: https://dotenvx.com/precommit","\u{1F510} prevent building .env in docker: https://dotenvx.com/prebuild","\u{1F916} agentic secret storage: https://dotenvx.com/as2","\u26A1\uFE0F secrets for agents: https://dotenvx.com/as2","\u{1F6E1}\uFE0F auth for agents: https://vestauth.com","\u{1F6E0}\uFE0F  run anywhere with `dotenvx run -- yourcommand`","\u2699\uFE0F  specify custom .env file path with { path: '/custom/path/.env' }","\u2699\uFE0F  enable debug logging with { debug: true }","\u2699\uFE0F  override existing env vars with { override: true }","\u2699\uFE0F  suppress all logs with { quiet: true }","\u2699\uFE0F  write to custom object with { processEnv: myObject }","\u2699\uFE0F  load multiple .env files with { path: ['.env.local', '.env'] }"];function q(){return m[Math.floor(Math.random()*m.length)]}function v(t){return typeof t=="string"?!["false","0","no","off",""].includes(t.toLowerCase()):!!t}function Q(){return process.stdout.isTTY}function W(t){return Q()?`\x1B[2m${t}\x1B[0m`:t}const H=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function J(t){const o={};let n=t.toString();n=n.replace(/\r\n?/mg,`
`);let r;for(;(r=H.exec(n))!=null;){const s=r[1];let c=r[2]||"";c=c.trim();const e=c[0];c=c.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),e==='"'&&(c=c.replace(/\\n/g,`
`),c=c.replace(/\\r/g,"\r")),o[s]=c}return o}function z(t){t=t||{};const o=y(t);t.path=o;const n=u.configDotenv(t);if(!n.parsed){const e=new Error(`MISSING_DATA: Cannot parse ${o} for an unknown reason`);throw e.code="MISSING_DATA",e}const r=F(t).split(","),s=r.length;let c;for(let e=0;e<s;e++)try{const a=r[e].trim(),i=Z(n,a);c=u.decrypt(i.ciphertext,i.key);break}catch(a){if(e+1>=s)throw a}return u.parse(c)}function X(t){console.error(`[dotenv@${T}][WARN] ${t}`)}function O(t){console.log(`[dotenv@${T}][DEBUG] ${t}`)}function I(t){console.log(`[dotenv@${T}] ${t}`)}function F(t){return t&&t.DOTENV_KEY&&t.DOTENV_KEY.length>0?t.DOTENV_KEY:process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0?process.env.DOTENV_KEY:""}function Z(t,o){let n;try{n=new URL(o)}catch(a){if(a.code==="ERR_INVALID_URL"){const i=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw i.code="INVALID_DOTENV_KEY",i}throw a}const r=n.password;if(!r){const a=new Error("INVALID_DOTENV_KEY: Missing key part");throw a.code="INVALID_DOTENV_KEY",a}const s=n.searchParams.get("environment");if(!s){const a=new Error("INVALID_DOTENV_KEY: Missing environment part");throw a.code="INVALID_DOTENV_KEY",a}const c=`DOTENV_VAULT_${s.toUpperCase()}`,e=t.parsed[c];if(!e){const a=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${c} in your .env.vault file.`);throw a.code="NOT_FOUND_DOTENV_ENVIRONMENT",a}return{ciphertext:e,key:r}}function y(t){let o=null;if(t&&t.path&&t.path.length>0)if(Array.isArray(t.path))for(const n of t.path)g.existsSync(n)&&(o=n.endsWith(".vault")?n:`${n}.vault`);else o=t.path.endsWith(".vault")?t.path:`${t.path}.vault`;else o=N.resolve(process.cwd(),".env.vault");return g.existsSync(o)?o:null}function w(t){return t[0]==="~"?N.join(P.homedir(),t.slice(1)):t}function tt(t){const o=v(process.env.DOTENV_CONFIG_DEBUG||t&&t.debug),n=v(process.env.DOTENV_CONFIG_QUIET||t&&t.quiet);(o||!n)&&I("Loading env from encrypted .env.vault");const r=u._parseVault(t);let s=process.env;return t&&t.processEnv!=null&&(s=t.processEnv),u.populate(s,r,t),{parsed:r}}function et(t){const o=N.resolve(process.cwd(),".env");let n="utf8",r=process.env;t&&t.processEnv!=null&&(r=t.processEnv);let s=v(r.DOTENV_CONFIG_DEBUG||t&&t.debug),c=v(r.DOTENV_CONFIG_QUIET||t&&t.quiet);t&&t.encoding?n=t.encoding:s&&O("No encoding is specified. UTF-8 is used by default");let e=[o];if(t&&t.path)if(!Array.isArray(t.path))e=[w(t.path)];else{e=[];for(const p of t.path)e.push(w(p))}let a;const i={};for(const p of e)try{const E=u.parse(g.readFileSync(p,{encoding:n}));u.populate(i,E,t)}catch(E){s&&O(`Failed to load ${p} ${E.message}`),a=E}const h=u.populate(r,i,t);if(s=v(r.DOTENV_CONFIG_DEBUG||s),c=v(r.DOTENV_CONFIG_QUIET||c),s||!c){const p=Object.keys(h).length,E=[];for(const V of e)try{const d=N.relative(process.cwd(),V);E.push(d)}catch(d){s&&O(`Failed to load ${V} ${d.message}`),a=d}I(`injecting env (${p}) from ${E.join(",")} ${W(`-- tip: ${q()}`)}`)}return a?{parsed:i,error:a}:{parsed:i}}function ot(t){if(F(t).length===0)return u.configDotenv(t);const o=y(t);return o?u._configVault(t):(X(`You set DOTENV_KEY but you are missing a .env.vault file at ${o}. Did you forget to build it?`),u.configDotenv(t))}function nt(t,o){const n=Buffer.from(o.slice(-64),"hex");let r=Buffer.from(t,"base64");const s=r.subarray(0,12),c=r.subarray(-16);r=r.subarray(12,-16);try{const e=M.createDecipheriv("aes-256-gcm",n,s);return e.setAuthTag(c),`${e.update(r)}${e.final()}`}catch(e){const a=e instanceof RangeError,i=e.message==="Invalid key length",h=e.message==="Unsupported state or unable to authenticate data";if(a||i){const p=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw p.code="INVALID_DOTENV_KEY",p}else if(h){const p=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw p.code="DECRYPTION_FAILED",p}else throw e}}function rt(t,o,n={}){const r=!!(n&&n.debug),s=!!(n&&n.override),c={};if(typeof o!="object"){const e=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw e.code="OBJECT_REQUIRED",e}for(const e of Object.keys(o))Object.prototype.hasOwnProperty.call(t,e)?(s===!0&&(t[e]=o[e],c[e]=o[e]),r&&O(s===!0?`"${e}" is already defined and WAS overwritten`:`"${e}" is already defined and was NOT overwritten`)):(t[e]=o[e],c[e]=o[e]);return c}const u={configDotenv:et,_configVault:tt,_parseVault:z,config:ot,decrypt:nt,parse:J,populate:rt};l.exports.configDotenv=u.configDotenv,l.exports._configVault=u._configVault,l.exports._parseVault=u._parseVault,l.exports.config=u.config,l.exports.decrypt=u.decrypt,l.exports.parse=u.parse,l.exports.populate=u.populate,l.exports=u;var b=l.exports;D(b);const f={};process.env.DOTENV_CONFIG_ENCODING!=null&&(f.encoding=process.env.DOTENV_CONFIG_ENCODING),process.env.DOTENV_CONFIG_PATH!=null&&(f.path=process.env.DOTENV_CONFIG_PATH),process.env.DOTENV_CONFIG_QUIET!=null&&(f.quiet=process.env.DOTENV_CONFIG_QUIET),process.env.DOTENV_CONFIG_DEBUG!=null&&(f.debug=process.env.DOTENV_CONFIG_DEBUG),process.env.DOTENV_CONFIG_OVERRIDE!=null&&(f.override=process.env.DOTENV_CONFIG_OVERRIDE),process.env.DOTENV_CONFIG_DOTENV_KEY!=null&&(f.DOTENV_KEY=process.env.DOTENV_CONFIG_DOTENV_KEY);var $=f;D($);const st=/^dotenv_config_(encoding|path|quiet|debug|override|DOTENV_KEY)=(.+)$/;var C=function(t){const o=t.reduce(function(n,r){const s=r.match(st);return s&&(n[s[1]]=s[2]),n},{});return"quiet"in o||(o.quiet="true"),o};D(C),function(){b.config(Object.assign({},$,C(process.argv)))}();export{U as default};
